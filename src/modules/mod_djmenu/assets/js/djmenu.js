/**
 * @version $Id: djmenu.js 4 2014-05-07 18:42:25Z szymon $
 * @package DJ-Menu
 * @copyright Copyright (C) 2012 DJ-Extensions.com, All rights reserved.
 * @license DJ-Extensions.com Proprietary Use License
 * @author url: http://dj-extensions.com
 * @author email contact@dj-extensions.com
 * @developer Szymon Woronowski - szymon.woronowski@design-joomla.eu
 */
(function($){this.afterDJMenuHide=function(){};var i=this.DJMenu=function(a,b){this.options={delay:500,animIn:'fadeIn',animOut:'fadeOut',animSpeed:'normal',duration:450,wrap:null,direction:'ltr',touch:(('ontouchstart'in window)||(navigator.MaxTouchPoints>0)||(navigator.msMaxTouchPoints>0))};this.init(a,b)};i.prototype.init=function(c,d){var e=this;e.options=Object.merge(e.options,d);if(!c)return;e.options.direction=window.getComputedStyle(document.body).getPropertyValue('direction');switch(e.options.animSpeed){case'fast':e.options.duration=250;break;case'slow':e.options.duration=650;break}c.addClass(e.options.animSpeed);var f=c.getChildren('li.dj-up');e.kids=[];if(!e.options.wrap)e.options.wrap=c;else e.options.wrap=$(e.options.wrap);f.each(function(a,b){e.kids[b]=new j(a,0,e,e.options)})};var j=function(a,b,c,d){this.options={};this.init(a,b,c,d)};j.prototype.init=function(a,b,c,d){var f=this;f.options=Object.merge(f.options,d);f.menu=a;f.level=b;f.parent=c;f.timer=null;f.sub=a.getElement('ul');var g='mouseenter';if(f.options.touch){g='click';var h=a.getElement('a');if(h&&h.getParent()==a)h.addEvent('click',function(e){if(f.sub&&!f.menu.hasClass('hover'))e.preventDefault()})}f.menu.addEvent(g,f.showSubmenu.bind(f));f.menu.addEvent('mouseleave',f.hideSubmenu.bind(f));if(f.sub){f.kids=[];f.initKids()}};j.prototype.showSubmenu=function(){var a=this;clearTimeout(a.timer);if(a.menu.hasClass('hover')&&!a.sub.hasClass(a.options.animOut)){return}clearTimeout(a.animTimer);a.menu.addClass('hover');if(a.sub&&!a.DirDone)a.checkDir();a.hideOther();if(a.sub){a.sub.removeClass(a.options.animOut);a.sub.addClass(a.options.animIn)}};j.prototype.hideSubmenu=function(){var a=this;if(a.sub){a.timer=setTimeout(function(){a.sub.removeClass(a.options.animIn);a.sub.addClass(a.options.animOut);a.animTimer=setTimeout(function(){a.menu.removeClass('hover');if((afterDJMenuHide))afterDJMenuHide()},a.options.duration)},a.options.delay)}else{a.menu.removeClass('hover')}};j.prototype.checkDir=function(){var a=this;a.DirDone=true;var b=a.sub.getCoordinates();var c=a.options.wrap.getCoordinates();if(a.options.direction=='ltr'){var d=b.left+b.width-c.width-c.left;if(d>0){if(a.level){a.sub.setStyle('right',a.sub.getStyle('left'));a.sub.setStyle('left','auto')}else{a.sub.setStyle('margin-left',-d)}}}else if(a.options.direction=='rtl'){var d=b.left-c.left;if(d<0){if(a.level){a.sub.setStyle('left',a.sub.getStyle('right'));a.sub.setStyle('right','auto')}else{a.sub.setStyle('margin-right',d)}}}};j.prototype.initKids=function(){var c=this;var d=c.sub.getChildren();d.each(function(a,b){c.kids[b]=new j(a,c.level+1,c,c.options)})};j.prototype.hideOther=function(){var b=this;b.parent.kids.each(function(a){if(a.menu.hasClass('hover')&&a!=b){if(a.sub){a.hideOtherSub();a.sub.removeClass(a.options.animIn);a.sub.addClass(a.options.animOut);a.animTimer=setTimeout(function(){a.menu.removeClass('hover');if((afterDJMenuHide))afterDJMenuHide()},b.options.duration)}else{a.menu.removeClass('hover')}}})};j.prototype.hideOtherSub=function(){var b=this;b.kids.each(function(a){if(a.sub){a.hideOtherSub();a.sub.removeClass(a.options.animIn);a.sub.removeClass(a.options.animOut)}a.menu.removeClass('hover')})}})(document.id);